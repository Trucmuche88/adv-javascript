Vue.component("search",{template:'\n        <div class="search">\n            <input \n                type="text" \n                placeholder="Искать..."\n                class="goods-search" \n                @input="search"\n            />\n        </div>',methods:{search(t){this.$emit("search",t.target.value)}}}),Vue.component("cart-item",{props:["item"],methods:{removeFromCartHandler(){this.$emit("removeFromCart",this.item.id)}},template:'\n        <li :data-id="item.id" class="cart-item">\n            {{item.title}} ({{item.quantity}}) \n            <button \n                @click="removeFromCartHandler"\n            >-</button>\n        </li>'}),Vue.component("cart",{props:["cart"],data:function(){return{isCartVisible:!1}},methods:{isVisibleCart(){this.isCartVisible=!this.isCartVisible},removeFromCartHandler(t){this.$emit("removeFromCart",t)}},template:'\n        <div class="cart">\n            <button \n                class="cart-button" \n                type="button"\n                @click="isVisibleCart" \n            >\n                Корзина {{ cart.length }}\n            </button>\n            <div v-if="isCartVisible">\n                <ul>\n                    <cart-item \n                        v-for="item in cart"\n                        :key="item.id"\n                        :item="item"\n                        @removeFromCart="removeFromCartHandler"\n                    />\n                </ul>\n            </div>\n        </div>'}),Vue.component("goods-item",{props:["good"],methods:{addToCart(){this.$emit("addToCart",this.good.id)}},template:'\n        <div :data-id="good.id" class="goods-item">\n            <h3>{{ good.title }}</h3>\n            <p>{{ good.price }}</p>\n            <button @click="addToCart">+</button>\n        </div>'}),Vue.component("goods-list",{props:["goods"],methods:{addToCartHandler(t){this.$emit("addToCart",t)}},template:'\n        <div class="goods-list">\n            <goods-item \n                v-for="good in goods"\n                :key="good.id"\n                :good="good"\n                @addToCart="addToCartHandler"\n            />\n        </div>'}),new Vue({el:"#app",template:'\n        <div>\n            <header>\n                <search \n                    @search="searchHandler"\n                />\n                <cart\n                    :cart="cart"\n                    @removeFromCart="removeFromCartHandler"\n                />\n            </header>\n            <main>\n                <goods-list \n                    :goods="filteredGoods"\n                    @addToCart="addToCartHandler"\n                />\n            </main>\n        </div>',data:{goods:[],filteredGoods:[],cart:[],isCartVisible:!1,search:""},methods:{makeGETRequest(t,e){let o;window.XMLHttpRequest?o=new XMLHttpRequest:window.ActiveXObject&&(o=new ActiveXObject("Microsoft.XMLHTTP")),o.onreadystatechange=function(){4===o.readyState&&e(o.responseText)},o.open("GET",t,!0),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),o.setRequestHeader("Access-Control-Allow-Origin","*"),o.send()},isVisibleCart(){this.isCartVisible=!this.isCartVisible},async removeFromCartHandler(t){const e=this.cart.find((e=>e.id==t)),o=await fetch("http://127.0.0.1:3000/removeFromCart",{method:"DELETE",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}),i=await o.json();this.cart=i,console.log("Great Success !")},addToCartHandler(t){const e=this.goods.find((e=>e.id==t));fetch("http://127.0.0.1:3000/addToCart",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((t=>t.json())).then((t=>{this.cart=t}))},searchHandler(t){""===t&&(this.filteredGoods=this.goods);const e=new RegExp(t,"gi");this.filteredGoods=this.goods.filter((t=>e.test(t.title))),console.log(this.filteredGoods)}},mounted(){this.makeGETRequest("http://127.0.0.1:3000/catalogData",(t=>{this.goods=JSON.parse(t),this.filteredGoods=JSON.parse(t)})),this.makeGETRequest("http://127.0.0.1:3000/cart",(t=>{this.cart=JSON.parse(t)}))}});